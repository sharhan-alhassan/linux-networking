

## Notes:
- `grep`: `g`lobally search for a `r`egular `e`xpression and `p`rint it out -- searching for a "string" of words 
- [https://linuxize.com/post/linux-ip-command/](IP cli tool)

- syntax: grep "string" filename(s)

## Tools
1. ip command (ip "larn") [command]
- link : display network and interfaces
- addr : IP addresses
- route: route table
- neigh: ARP table

## checking IP Addresses
- nmcli
- ip addr show
- man ifconfig

- `nmcli device show`: to get complete information on known devices

- `nmcli connection show`: to get an overview on active connected profiles(networks like wifi connections)

- ip route show
- routel

## Network
- switches - forwards packets with the internal network
- router - forwards packets between networks

- client --> switch --> router --> internet -->router --> switch --> server

- This physical process is refered to as `Software Defined Networkd (SDN)` in cloud

## OSI Model (open systems iterconnection)
- `Mnemonic: All People Seem To Need Data Processing`
7. `Application` -- Interface for users to send/receive data. Eg; web app.
[Protocols:Http,POP3,SMTP,DNS,SOAP]


6. `Presentation` -- converts request from app into a universal format. Eg; a jped or gif being to actual images on the screen.
[Protocols:TLS,SSL,MIME,JPEG,GIF]


5. `Session` -- Permits to open/close a session between the process and response. Eg; Brower initiates a TCP connection with server. Server sends response and close the connection. The browser then maintain this connection through `sessions`.
[Protocols:LDAP,NetBIOS,PPTP,RPC,SMB,SSL]


4. `Transport` -- Provides how data is sent providing `validation` and `security`. Eg;
Browser breaks TCP requests into manageable portions, applies label to protect the ordering and transports the pieces across the sessions. Data is referred to as `segment` and each segment contains a `checksum` for verfication upon receipt
[Protocols:TCP,UDP,iSCSI]
Network streams in this layer is achieved by an addressing system known as `Port numbers`
Data type: `segment`


3. `Network` -- Looks for the best path to reach destination[IP].Eg; Browser uses the IP to reach the local or remote server.
Data type: `packets`
[Protocols:IP,IPSec,ICMP,RIP]
Devices: Router


2. `DataLink` -- Handles communication b/n adjacent nodes using [MAC] addresses. Eg;
Data is referred as: `frames`
[Protocols:Ethernet,Frame_Relay,WiFi,PPP,VLAN,MAC]
Devices: Switches


1. `Physical` -- Handles [bits] level transmission b/n network nodes.
Eg; Cabling
Data type: `bits`
- In ethernet cables, bits are tranferred in the form of `electric pulses`
- In WiFi, bits are `radio waves`
- In Fiber, bits are `light pulses`

[Protocols:Ethernet,Fiber]

## OSI Model -- Layer 2 vs Layer 3
- Layer 2 (Datalink) uses `MAC Addresses` and is responsible for packet delivery from `hop to hop`
- Layer 3 (Network) uses `IP Addresses` and is responsible for packet delivery from `end to end`
- Layer 4 (Transport) is responsible for `service to service` delivery

- For Layer 2, you track frames from hop to hop, but IP, you track packets movements from end to end
- The Data to be sent is encapsulated in `IP header + Data itself` which include `source and destination IP addresses`
- The IP Header and Data is further encapsulated in `MAC Address` header which include `source and destination MAC addresses` of the current hop in the path towards the final destination
- In each Router in the data journey, the MAC Address is stripped and regerated to get it to the next hop
- The `IP header` generated by the first computer is only stripped off by the final computer, hence the IP header handled the `end to end` delivery

## Note
```
As the data is handed from layer to layer, each layer adds the information it requires to accomplish its goal before the complete datagram is converted to 1s and 0s and sent across the wire. For example:

Layer 4 will add a TCP header which would include a Source and Destination port
Layer 3 will add an IP header which would include a Source and Destination IP address
Layer 2 would add an Ethernet header which would include a Source and Destination MAC address

It is important to understand that as data is sent across the wire, it gets passed down the stack and each layer adds its own header to help it accomplish its goal. On the receiving end, the headers get stripped off one at a time, layer by layer, as the data is sent back up to the Application layer.
```

### Anatomy of IPs
- Class A -- 2,097,152 (0.0.0.0 -- 127.255.255.255)
- Class B -- 65,534 (128.0.0.0 -- 191.255.255.255)
- Class C -- 254 (192.0.0.0 -- 223.255.255.255)


### NAT
- Basically mapping your internal IP of your machine to the router's IP to be able to route data to the local machine. Thus, your machine's IP is not expose to the internet but the router's IP or ISP's IP

### Routing
- A routing Table list `destinations` and `gateways` for the networks the host belongs to 

Destination             Gateway
0.0.0.0                 172.31.96.1     
#If destination is to outside/anywhere the network, use the gateway

172.31.96.0             0.0.0.0     
#If destination is internal/inside local network, don't use the Gateway


## BGP (Border Gateway Protocol)
- A protocol that enables the internet to work


## ARP (Address Resolution Protocol) -- Data Link Layer
- ARP is a communication protocol used for discovering the MAC address associated with a given network layer address, given its IP address

- Occurs within a [LAN] -- Local Area Network. If machine is not within LAN, then the Gateway IP is used for outward searching

- Simply, [ARP] is used for mapping `IP Address` to a `MAC address` on the network to `48-bit` MAC address

- Main duty of [ARP] is to convert/map the [32-bit] IP address (for IPv4)


### Packet Connection Sequence -- ARP
- `Communication process`: The client will send out is `IP, MAC address and Destination IP` to the remote server in `BROADCAST` and asks, "This is my MAC address and IP, who does this IP(destination) match". When the remote server's IP which matches, it saves the source/client IP and MAC in its `ARP table` and replies to the client/source in a [UNICAST]. The client/source IP now also receives the data and saves the remote server's `IP and MAC address` in its `ARP table` too and `cache` for subsequent connection. 

- To view ARP Table: `ip n`

### DNS
- `Fully Qualified Domain Name (FQDN)`: Is the complete domain name for a specific host in the network. Eg; www.example.com

### DNS Resolution Process
1. Take `www.example.com` for instance. There's an implied `implied(.)` at the end of `.com`. This part is resolved by the `root servers` and forwarded to the `TLDs (Top Level Domain servers)`

2. The TLD servers resolves the `.com` part and forwards it the `DNS`

3. The `DNS` resolves the `example.com` part

4. The `DNS` resolves the `www.example.com` or it resolves by other authoritative DNS within the same zone. Then it spits out the `IP Address` to be used for the search

### CLI practicals
- We'll use `dig`, a cli tool from `bind-utils` package. `Helps you get the DNS records associated with a domain name`


```bash
dig -4 www.cloudbintech.com         # -4: IP4

dig -4 www.cloudbintech.com +trace | awk 'length($0)<50'    # to get all part of domain resolvers
```

## TCP and Basic Handshake

- `Transmission Control Protocol (TCP)`: TCP exists in `Layer 4` along with `UDP`

- Highly reliable connection protocol through `Positive Acknowledgement with Retransmission(PAR)`

- Data is re-sent if an acknowlegment isn't received

### TCP Handshake process: How a Machine A connects with Machine B

```python
- Machine A (IP) sends a SYN request to the server (Machine B)

- Machine B returns the SYN and ACK request back to Machine A
## ACK -- Acknowlegment
## SYN -- Synchronize

- Machine A after receiving the acknowledgment(ACK) then sends the ACK requests back together with the data DATA (ACK + DATA)
```

`Summary:`
   Mode----------Flag

1. SYN -----> syn=1
2. <--------SYN+ACK syn=1, ack=1
3. ACK+DATA ------> ack=1
4. FIN --------> close connection


## PACKET CONNECTION FLOW

```bash
1. DNS -- DNS Query sent to provide IP of destination
2. ARP -- exchange IPs and MAC Addresses and put in respective ARP Tables and cache them.
3. TCP -- Starts TCP 3-way handshake (SYN->SYN ACK->ACK)
```

[Summary:]
1. [DNS]: First resolve domain name to its IP using DNS. Now you have the Destination IP given to you by the DNS(which also has its own IP). Yes DNS servers have IPs too. Your query first goes to the DNS IP which later resolves the domain-name into its IP for you

2. [ARP]: Use your IP, MAC Address and Destination IP and send a BROADCAST request, "hey, whose IP address matches this Destination IP".

3. [TCP]: If you find a response from the Destination IP match, then you initiate your TCP 3-way Handshake. If not the packet is dropped.


### VPN:
- A [VPN] connection is an extension of a private network, using the IP connectivity of the internet to connect remote clients to remote sites in an encrypted private connection


## Static IPs vs DHCP
- `Static`: dedicated, unchanged IP address assigned to the device/host. Upon setting it, you must also specify subnet, gateway and DNS host information. Typically used for important network devices/host that require absolute connectivity

- `DHCP(Dynamic Host Control Protocol)`: Dynanic IPs assigned to hosts/devices from a pool of IPs with the DHCP scope. DHCP will normally provide subnet, gateway and DNS information upon assigning IP address. IPs and leased on expiration and typically used for hosts/devices and clients requiring transient connections.


### DHCP SEQUENCE
1. `DHCP DISCOVER`: A client (a brand new laptop/device) broadcasts a request(first time connecting to the network, eg: ISP) looking for a DHCP host that assign it an IP address. "Hey, who can give me a new IP address, I'm new here"

2. `DHCP OFFER`: A DHCP host server responds with an `OFFER`, "I can do that". And assign the client an IP

3. `DHCP REQUEST`: Then the client then makes an `official` request of that IP address. "Okay, you're offering me <ip>?"

4. `DHCP ACKNOWLEDGMENT`: The DHCP host sever then response with an acknowlegemnt and be like "Okay, that <ip> is all yours". 

*************************************************************

- Typically, on most home or small business networks, your Internet WI-FI or router acts as the DHCP server too.

- command: `ip r` will give you the default DHCP router IP.
Sample output: `default via 192.168.43.155 dev wlo1 proto dhcp metric 600` where `192.168.43.155` is the router's IP

*****************************************************************

## Teaming and Bonding Interface:: 
### Team Runners
1. `broadcast` : transmit data over all ports
2. `round-robin`: (Default). Transmit data over all ports in sequence
3. `active-backup`: One port is used while the other is reserved for backup
4. `loadbalance`: active load balanding and port selection
5. `LACP`: link aggregation control protocol

### Link watchers
1. `ethtool` : Default. watches the link state changes
2. `arp_ping`: monitors availability of MAC address using ARP
3. `nsna_ping`: neighborhood advertising neighborhood solicitation from ipv6 to monitor neighborhood interface

```bash
# route table
$ sudo route -n

# Install teamd and bash-completion
$ sudo apt install teamd bash-completion

# reload profile
$ source /etc/profile
```

### Routing
- Display kernel IP routing table
```bash
➜  class route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         192.168.43.59   0.0.0.0         UG    600    0        0 wlo1
169.254.0.0     0.0.0.0         255.255.0.0     U     1000   0        0 wlo1
172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0 docker0
192.168.43.0    0.0.0.0         255.255.255.0   U     600    0        0 wlo1

```


